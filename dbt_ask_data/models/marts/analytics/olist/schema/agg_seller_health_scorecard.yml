version: 2

models:
  - name: agg_seller_health_scorecard
    description: Comprehensive seller performance scorecard combining delivery quality, customer satisfaction, and fulfillment metrics. Provides risk assessment and improvement recommendations.
    columns:
      - name: seller_id
        description: Unique identifier for the seller
        tests:
          - not_null
          - unique
          - relationships:
              to: ref('stg_sellers')
              field: seller_id

      - name: total_orders
        description: Total number of orders fulfilled by this seller

      - name: unique_products_sold
        description: Number of distinct products sold by this seller

      - name: completed_orders
        description: Number of orders with successful completion (not canceled/unavailable)

      - name: canceled_orders
        description: Number of canceled orders

      - name: total_revenue
        description: Total revenue generated by this seller (rounded to 2 decimal places)

      - name: avg_order_value
        description: Average order value for this seller (rounded to 2 decimal places)

      - name: on_time_delivery_rate
        description: Percentage of orders delivered on or before estimated delivery date (rounded to 2 decimal places)

      - name: avg_fulfillment_time_hours
        description: Average fulfillment time from order purchase to delivery (in hours, rounded to 2 decimal places)

      - name: avg_review_score
        description: Average customer review score for this seller (scale 1-5, rounded to 2 decimal places)

      - name: satisfaction_rate
        description: Percentage of orders with 4+ star reviews (rounded to 2 decimal places)

      - name: first_sale_date
        description: Date of seller's first order

      - name: last_sale_date
        description: Date of seller's most recent order

      - name: seller_tenure_days
        description: Number of days since seller's first sale

      - name: delivery_quality_score
        description: Delivery quality component (0-40) based on on_time_delivery_rate. 95%+ = 40, decreasing by tiers.

      - name: customer_satisfaction_score
        description: Customer satisfaction component (0-35) based on average review score. 4.7+ = 35, decreasing by tiers.

      - name: fulfillment_score
        description: Order fulfillment component (0-25) based on completion rate. 95%+ = 25, decreasing by tiers.

      - name: performance_score
        description: Overall performance score (0-100) calculated as sum of delivery_quality_score + customer_satisfaction_score + fulfillment_score

      - name: risk_tier
        description: Seller risk classification - 'low' (score â‰¥85), 'medium' (65-84), or 'high' (<65)

      - name: days_to_improvement_target
        description: Estimated days needed to reach 95% on_time_delivery_rate (0 if already at target)

      - name: recommended_action
        description: Recommended action - 'maintain', 'monitor', 'improve_delivery', 'improve_quality', or 'investigate'
